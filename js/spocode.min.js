/*
 Spocode 2014-10-19 
*/
var SpocodeGame={FORCE_BUTTONS:!1,MUSIC_VOLUME:1,SFX_VOLUME:1,SHOW_FPS:!0};SpocodeGame.Boot=function(){},SpocodeGame.Boot.prototype={init:function(){this.input.maxPointers=2,this.stage.disableVisibilityChange=!0,this.scale.scaleMode=Phaser.ScaleManager.EXACT_FIT,this.scale.refresh(),this.time.advancedTiming=!0},preload:function(){},create:function(){this.state.start("Preloader")}},SpocodeGame.EndGame=function(){this.endkey=null,this.msg=null},SpocodeGame.EndGame.prototype={create:function(){this.msg=this.game.device.desktop?this.add.text(200,200,"All scrap collected, press enter to restart."):this.add.text(100,200,"All scrap collected, tap the screen to restart."),this.endkey=this.input.keyboard.addKey(Phaser.Keyboard.ENTER),this.input.onDown.add(this.mouse,this)},mouse:function(){this.state.start("Game")},update:function(){this.endkey.isDown&&this.state.start("Game")},shutdown:function(){this.msg.destroy()}},SpocodeGame.Game=function(){this.player=null,this.layer=null,this.cursors=null,this.jump=null,this.score=null,this.coins=null,this.coin_fx=null,this.score_text=null,this.btn_left_down=!1,this.btn_right_down=!1,this.btn_a_down=!1,this.btn_b_down=!1,this.MOVE_SPEED=200,this.GRAVITY=1e3,this.JUMP_SPEED=400,this.UI_TEXT="Loot gathered: ",this.NUM_COINS=0},SpocodeGame.Game.prototype={create:function(){this.physics.startSystem(Phaser.Physics.ARCADE),this.physics.arcade.gravity.y=this.GRAVITY,this.stage.backgroundColor="#666666",this.music=this.add.audio("the_complex",SpocodeGame.MUSIC_VOLUME,!0),this.music.play(),this.coinfx=this.add.audio("coinfx",SpocodeGame.SFX_VOLUME);var a=this.add.tilemap("map");if(a.addTilesetImage("Map","tileset"),a.setCollisionBetween(210,217),a.setCollision([146,147,181,182]),this.layer=a.createLayer("Base"),this.layer.resizeWorld(),this.player=this.add.sprite(100,120,"player"),this.player.animations.add("walk",Phaser.Math.numberArray(4,11)),this.player.animations.add("idle",Phaser.Math.numberArray(0,3)),this.player.animations.add("jump",Phaser.Math.numberArray(43,45)),this.player.animations.add("airborne",Phaser.Math.numberArray(46,47)),this.physics.enable(this.player,Phaser.Physics.ARCADE),this.player.anchor.setTo(.5,1),this.player.body.width*=.5,this.player.body.maxVelocity.y=500,this.camera.follow(this.player),this.coins=this.add.group(),a.createFromObjects("Objects",179,"coin","",!0,!1,this.coins),this.coins.forEach(function(a){a.animations.add("anim"),a.animations.play("anim",4,!0),this.physics.enable(a,Phaser.Physics.ARCADE),a.body.immovable=!0,a.body.allowGravity=!1},this),this.NUM_COINS=this.coins.length,this.cursors=this.input.keyboard.createCursorKeys(),this.jump=this.input.keyboard.addKey(Phaser.Keyboard.SPACEBAR),this.input.onDown.add(this.gofull,this),this.add.text(0,0,"Grab those coins!"),this.score_text=this.add.text(10,this.game.height-50,this.UI_TEXT+"0/"+this.NUM_COINS),this.score_text.fixedToCamera=!0,this.score_text.stroke="#ffffff",this.score_text.strokeThickness=2,SpocodeGame.FORCE_BUTTONS||!this.game.device.desktop){self=this;var b=this.add.button(32,this.game.height/2,"button-left");b.fixedToCamera=!0,b.onInputDown.add(function(){self.btn_left_down=!0}),b.onInputUp.add(function(){self.btn_left_down=!1});var c=this.add.button(128,this.game.height/2,"button-right");c.fixedToCamera=!0,c.onInputDown.add(function(){self.btn_right_down=!0}),c.onInputUp.add(function(){self.btn_right_down=!1});var d=this.add.button(this.game.width-96,this.game.height/2,"button-a");d.fixedToCamera=!0,d.onInputDown.add(function(){self.btn_a_down=!0}),d.onInputUp.add(function(){self.btn_a_down=!1})}},gofull:function(){this.scale.isFullScreen||this.scale.startFullScreen(!0)},update:function(){this.time.elapsed;this.physics.arcade.collide(this.player,this.layer),this.player.body.velocity.x=0,(this.jump.isDown||this.btn_a_down)&&this.player.body.onFloor()&&(this.player.animations.play("jump",7),this.player.body.velocity.y=-this.JUMP_SPEED),this.player.body.onFloor()||this.player.animations.play("airborne",7,!0),this.cursors.left.isDown||this.btn_left_down?(this.player.body.velocity.x=-this.MOVE_SPEED,this.player.scale.x=-1,this.player.body.onFloor()&&this.player.animations.play("walk",15,!0)):this.cursors.right.isDown||this.btn_right_down?(this.player.body.velocity.x=this.MOVE_SPEED,this.player.scale.x=1,this.player.body.onFloor()&&this.player.animations.play("walk",15,!0)):this.player.body.onFloor()&&this.player.animations.play("idle",7,!0);var a=this;this.physics.arcade.collide(this.player,this.coins,function(b,c){a.score++,a.coinfx.play(),c.destroy(),a.score_text.setText(a.UI_TEXT+a.score+"/"+a.NUM_COINS)}),this.score==this.NUM_COINS&&this.state.start("EndGame")},shutdown:function(){this.score=0,this.music.stop(),this.layer.destroy(),this.player.destroy(),this.coins.destroy()},render:function(){SpocodeGame.SHOW_FPS&&this.game.debug.text("FPS: "+this.time.fps,10,24)}},SpocodeGame.Preloader=function(){this.ready=!1},SpocodeGame.Preloader.prototype={preload:function(){this.stage.backgroundColor="#ffffff",this.add.text(200,200,"Loading"),this.load.image("tileset","assets/tiles.png"),this.load.tilemap("map","levels/level1.json",null,Phaser.Tilemap.TILED_JSON),this.load.spritesheet("player","assets/player.png",64,64,72),this.load.spritesheet("coin","assets/coin.png",40,43,4),this.load.audio("the_complex","assets/The Complex.ogg"),this.load.audio("coinfx","assets/completetask.ogg"),(SpocodeGame.FORCE_BUTTONS||!this.game.device.desktop)&&(this.load.spritesheet("button-a","assets/button_a.png"),this.load.spritesheet("button-b","assets/button_b.png"),this.load.spritesheet("button-left","assets/button_left.png"),this.load.spritesheet("button-right","assets/button_right.png"))},create:function(){},update:function(){this.cache.isSoundDecoded("the_complex")&&this.state.start("Game")}};